<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¿«é€Ÿè·¯å¾„æ£€æµ‹ - V14.2</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
font-family: system-ui, sans-serif; 
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
display: flex;
align-items: center;
justify-content: center;
padding: 20px;
}
.container {
background: white;
border-radius: 20px;
padding: 40px;
max-width: 800px;
width: 100%;
box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}
h1 { color: #333; margin-bottom: 10px; font-size: 28px; }
.subtitle { color: #666; margin-bottom: 30px; font-size: 14px; }
.status { 
padding: 15px; 
border-radius: 10px; 
margin: 10px 0;
font-size: 14px;
font-weight: 500;
}
.success { background: #d4edda; color: #155724; border-left: 4px solid #28a745; }
.error { background: #f8d7da; color: #721c24; border-left: 4px solid #dc3545; }
.warning { background: #fff3cd; color: #856404; border-left: 4px solid #ffc107; }
.info { background: #d1ecf1; color: #0c5460; border-left: 4px solid #17a2b8; }
.loading { 
text-align: center; 
padding: 40px;
color: #667eea;
font-size: 18px;
}
.spinner {
border: 4px solid #f3f3f3;
border-top: 4px solid #667eea;
border-radius: 50%;
width: 40px;
height: 40px;
animation: spin 1s linear infinite;
margin: 20px auto;
}
@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
.result-box {
background: #f8f9fa;
border: 1px solid #dee2e6;
border-radius: 8px;
padding: 15px;
margin: 15px 0;
font-family: monospace;
font-size: 12px;
}
.path { color: #667eea; font-weight: bold; }
.btn {
background: #667eea;
color: white;
border: none;
padding: 12px 30px;
border-radius: 8px;
cursor: pointer;
font-size: 16px;
font-weight: 600;
margin: 10px 5px;
transition: all 0.3s;
}
.btn:hover { background: #5568d3; transform: translateY(-2px); }
.btn-secondary { background: #6c757d; }
.btn-secondary:hover { background: #5a6268; }
code { 
background: #f8f9fa; 
padding: 2px 6px; 
border-radius: 4px; 
color: #e83e8c; 
}
</style>
</head>
<body>
<div class="container">
<h1>ğŸ” JavaScriptè·¯å¾„å¿«é€Ÿæ£€æµ‹</h1>
<div class="subtitle">è‡ªåŠ¨æ£€æµ‹å¹¶æµ‹è¯•JSæ–‡ä»¶çš„æœ€ä½³åŠ è½½è·¯å¾„</div>

<div id="results">
<div class="loading">
<div class="spinner"></div>
<div>æ­£åœ¨æ£€æµ‹è·¯å¾„...</div>
</div>
</div>

<div id="actions" style="text-align: center; display: none; margin-top: 20px;">
<button class="btn" onclick="location.reload()">é‡æ–°æ£€æµ‹</button>
<button class="btn btn-secondary" onclick="location.href='./index.html'">è¿”å›ä¸»é¡µ</button>
</div>
</div>

<script>
async function detectPaths() {
const results = document.getElementById('results');
const actions = document.getElementById('actions');

// åŸºç¡€è·¯å¾„ä¿¡æ¯
const currentPath = window.location.pathname;
const basePath = currentPath.substring(0, currentPath.lastIndexOf('/') + 1);
const baseUrl = window.location.origin + basePath;

let html = '';
html += '<div class="info">å½“å‰URL: <code>' + window.location.href + '</code></div>';
html += '<div class="info">åŸºç¡€è·¯å¾„: <code>' + baseUrl + '</code></div>';

// æµ‹è¯•æ–‡ä»¶
const testFile = 'workbench-config.js';

// è·¯å¾„æ ¼å¼
const pathFormats = [
{ path: 'js/' + testFile, label: 'ç›¸å¯¹è·¯å¾„ï¼ˆæ— ç‚¹ï¼‰' },
{ path: './js/' + testFile, label: 'ç›¸å¯¹è·¯å¾„ï¼ˆæœ‰ç‚¹ï¼‰' },
{ path: '/workbench/js/' + testFile, label: 'ç»å¯¹è·¯å¾„' },
{ path: baseUrl + 'js/' + testFile, label: 'å®Œæ•´URL' }
];

let workingPath = null;
let workingFormat = null;

// æµ‹è¯•æ¯ä¸ªè·¯å¾„
for (const format of pathFormats) {
try {
const response = await fetch(format.path, { method: 'HEAD' });
const contentType = response.headers.get('content-type') || 'unknown';
      
if (response.ok) {
html += `<div class="success">âœ… <strong>${format.label}</strong><br>`;
html += `è·¯å¾„: <span class="path">${format.path}</span><br>`;
html += `çŠ¶æ€: ${response.status} | ç±»å‹: ${contentType}</div>`;
        
if (!workingPath) {
workingPath = format.path;
workingFormat = format;
}
} else {
html += `<div class="error">âŒ <strong>${format.label}</strong><br>`;
html += `è·¯å¾„: ${format.path}<br>`;
html += `çŠ¶æ€: ${response.status} ${response.statusText}</div>`;
}
} catch (error) {
html += `<div class="error">âŒ <strong>${format.label}</strong><br>`;
html += `è·¯å¾„: ${format.path}<br>`;
html += `é”™è¯¯: ${error.message}</div>`;
}
}

// å¦‚æœæ‰¾åˆ°å¯ç”¨è·¯å¾„ï¼Œå°è¯•åŠ è½½
if (workingPath) {
html += '<div class="warning">â³ æ­£åœ¨æµ‹è¯•åŠ è½½æ¨¡å—...</div>';
results.innerHTML = html;

try {
const script = document.createElement('script');
script.src = workingPath;

await new Promise((resolve, reject) => {
script.onload = resolve;
script.onerror = reject;
document.head.appendChild(script);
});

// æ£€æŸ¥æ¨¡å—æ˜¯å¦æŒ‚è½½
const isLoaded = typeof window.WorkbenchConfig !== 'undefined';

if (isLoaded) {
html += `<div class="success"><strong>ğŸ‰ åŠ è½½æˆåŠŸï¼</strong><br>`;
html += `æ¨¡å—å·²æ­£ç¡®æŒ‚è½½åˆ° window.WorkbenchConfig<br>`;
html += `ç‰ˆæœ¬: ${window.WorkbenchConfig?.SYSTEM?.VERSION || 'æœªçŸ¥'}</div>`;
html += `<div class="result-box"><strong>æ¨èé…ç½®ï¼š</strong><br><br>`;
html += `åœ¨ index.html ä¸­ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š<br><br>`;
html += `<code>&lt;script src="${workingFormat.path.replace(testFile, 'workbench-XXX.js')}"&gt;&lt;/script&gt;</code><br><br>`;
html += `ç¤ºä¾‹ï¼š<br>`;
html += `<code>&lt;script src="${workingFormat.path.replace(testFile, 'workbench-config.js')}"&gt;&lt;/script&gt;</code><br>`;
html += `<code>&lt;script src="${workingFormat.path.replace(testFile, 'workbench-utils.js')}"&gt;&lt;/script&gt;</code><br>`;
html += `<code>&lt;script src="${workingFormat.path.replace(testFile, 'workbench-app.js')}"&gt;&lt;/script&gt;</code>`;
html += `</div>`;
} else {
html += `<div class="warning">âš ï¸ <strong>æ–‡ä»¶å·²åŠ è½½ä½†æ¨¡å—æœªæŒ‚è½½</strong><br>`;
html += `æ£€æŸ¥JSæ–‡ä»¶æœ«å°¾æ˜¯å¦æœ‰ï¼š<code>window.WorkbenchConfig = WorkbenchConfig;</code></div>`;
}
} catch (error) {
html += `<div class="error">âŒ <strong>åŠ è½½æµ‹è¯•å¤±è´¥</strong><br>${error.message}</div>`;
}
} else {
html += `<div class="error"><strong>âŒ æ— æ³•æ‰¾åˆ°å¯ç”¨è·¯å¾„ï¼</strong><br><br>`;
html += `<strong>å¯èƒ½åŸå› ï¼š</strong><br>`;
html += `1. JSæ–‡ä»¶ä¸å­˜åœ¨äºæœåŠ¡å™¨ä¸Š<br>`;
html += `2. Cloudflare Pages æ„å»ºé…ç½®é”™è¯¯<br>`;
html += `3. GitHubä»“åº“ä¸­æ–‡ä»¶æœªæ­£ç¡®æ¨é€<br><br>`;
html += `<strong>å»ºè®®æ“ä½œï¼š</strong><br>`;
html += `1. æ£€æŸ¥GitHubä»“åº“: <code>workbench/js/</code> æ–‡ä»¶å¤¹<br>`;
html += `2. ç¡®è®¤Cloudflare Pagesæ„å»ºè¾“å‡ºç›®å½•è®¾ç½®ä¸º: <code>workbench</code><br>`;
html += `3. æŸ¥çœ‹Cloudflare Pageséƒ¨ç½²æ—¥å¿—<br>`;
html += `4. å°è¯•åœ¨æµè§ˆå™¨ç›´æ¥è®¿é—®: <code>${baseUrl}js/workbench-config.js</code></div>`;
}

results.innerHTML = html;
actions.style.display = 'block';
}

// è‡ªåŠ¨å¼€å§‹æ£€æµ‹
detectPaths();
</script>
</body>
</html>
