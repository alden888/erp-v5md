<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ–‡ä»¶æ£€æµ‹ - V14.2 PRO</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-8">
<div class="max-w-4xl mx-auto">
<h1 class="text-3xl font-bold mb-8 text-red-500">ğŸ” æ–‡ä»¶å¯è®¿é—®æ€§æ£€æµ‹</h1>

<div class="bg-gray-800 p-6 rounded-lg mb-6">
<h2 class="text-xl font-bold mb-4">å½“å‰URLä¿¡æ¯</h2>
<div class="space-y-2 text-sm font-mono">
<p><strong>å®Œæ•´URL:</strong> <span id="full-url"></span></p>
<p><strong>åŸŸå:</strong> <span id="hostname"></span></p>
<p><strong>è·¯å¾„:</strong> <span id="pathname"></span></p>
<p><strong>åŸºç¡€URL:</strong> <span id="base-url"></span></p>
</div>
</div>

<div class="bg-gray-800 p-6 rounded-lg mb-6">
<h2 class="text-xl font-bold mb-4">JavaScriptæ–‡ä»¶æ£€æµ‹</h2>
<button onclick="checkFiles()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded mb-4">
å¼€å§‹æ£€æµ‹
</button>
<div id="file-results" class="space-y-2"></div>
</div>

<div class="bg-gray-800 p-6 rounded-lg mb-6">
<h2 class="text-xl font-bold mb-4">åŠ è½½æµ‹è¯•</h2>
<button onclick="testLoad()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded mb-4">
æµ‹è¯•åŠ è½½ç¬¬ä¸€ä¸ªæ¨¡å—
</button>
<div id="load-result" class="mt-4 p-4 bg-gray-900 rounded"></div>
</div>

<div class="mt-8 text-center">
<a href="./index.html" class="inline-block bg-gray-700 hover:bg-gray-600 px-6 py-3 rounded">
è¿”å›ä¸»é¡µé¢
</a>
<a href="./diagnostic.html" class="inline-block bg-gray-700 hover:bg-gray-600 px-6 py-3 rounded ml-4">
ç³»ç»Ÿè¯Šæ–­
</a>
</div>
</div>

<script>
// æ˜¾ç¤ºURLä¿¡æ¯
document.getElementById('full-url').textContent = window.location.href;
document.getElementById('hostname').textContent = window.location.hostname;
document.getElementById('pathname').textContent = window.location.pathname;
const basePath = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1);
document.getElementById('base-url').textContent = window.location.origin + basePath;

// JavaScriptæ–‡ä»¶åˆ—è¡¨
const jsFiles = [
    'workbench-config.js',
    'workbench-utils.js',
    'workbench-modal.js',
    'workbench-state.js',
    'workbench-storage.js',
    'workbench-auth.js',
    'workbench-firebase.js',
    'workbench-dashboard.js',
    'workbench-orders.js',
    'workbench-suppliers.js',
    'workbench-finance.js',
    'workbench-expenses.js',
    'workbench-crm.js',
    'workbench-app.js'
];

async function checkFiles() {
    const resultsDiv = document.getElementById('file-results');
    resultsDiv.innerHTML = '<p class="text-yellow-500">ğŸ”„ æ£€æµ‹ä¸­...</p>';
    
    const results = [];
    
    // å°è¯•ä¸åŒçš„è·¯å¾„æ ¼å¼
    const pathFormats = [
        (file) => `./js/${file}`,           // ç›¸å¯¹è·¯å¾„ ./js/
        (file) => `js/${file}`,             // ç›¸å¯¹è·¯å¾„ js/
        (file) => `/workbench/js/${file}`,  // ç»å¯¹è·¯å¾„
        (file) => `${basePath}js/${file}`   // åŸºäºå½“å‰è·¯å¾„
    ];
    
    for (const file of jsFiles) {
        const fileResults = { file, paths: [] };
        
        for (let i = 0; i < pathFormats.length; i++) {
            const path = pathFormats[i](file);
            try {
                const response = await fetch(path, { method: 'HEAD' });
                fileResults.paths.push({
                    path,
                    status: response.status,
                    ok: response.ok,
                    type: response.headers.get('content-type')
                });
            } catch (error) {
                fileResults.paths.push({
                    path,
                    status: 'ERROR',
                    ok: false,
                    error: error.message
                });
            }
        }
        
        results.push(fileResults);
    }
    
    // æ˜¾ç¤ºç»“æœ
    let html = '';
    for (const result of results) {
        const anySuccess = result.paths.some(p => p.ok);
        const color = anySuccess ? 'text-green-500' : 'text-red-500';
        const icon = anySuccess ? 'âœ…' : 'âŒ';
        
        html += `<div class="border border-gray-700 p-3 rounded">`;
        html += `<div class="${color} font-bold mb-2">${icon} ${result.file}</div>`;
        
        for (let i = 0; i < result.paths.length; i++) {
            const p = result.paths[i];
            const pathColor = p.ok ? 'text-green-400' : 'text-red-400';
            const pathLabel = ['ç›¸å¯¹ ./', 'ç›¸å¯¹(æ— ç‚¹)', 'ç»å¯¹', 'åŸºäºå½“å‰'][i];
            
            html += `<div class="text-sm ml-4 ${pathColor}">`;
            html += `[${pathLabel}] ${p.path} â†’ `;
            if (p.ok) {
                html += `<span class="text-green-500">âœ“ ${p.status}</span>`;
                if (p.type) html += ` (${p.type})`;
            } else {
                html += `<span class="text-red-500">âœ— ${p.status || p.error}</span>`;
            }
            html += `</div>`;
        }
        
        html += `</div>`;
    }
    
    resultsDiv.innerHTML = html;
}

async function testLoad() {
    const resultDiv = document.getElementById('load-result');
    resultDiv.innerHTML = '<p class="text-yellow-500">ğŸ”„ åŠ è½½æµ‹è¯•ä¸­...</p>';
    
    // å…ˆæ£€æµ‹å“ªä¸ªè·¯å¾„å¯ç”¨
    const testPaths = [
        './js/workbench-config.js',
        'js/workbench-config.js',
        '/workbench/js/workbench-config.js',
        `${basePath}js/workbench-config.js`
    ];
    
    let workingPath = null;
    for (const path of testPaths) {
        try {
            const response = await fetch(path, { method: 'HEAD' });
            if (response.ok) {
                workingPath = path;
                break;
            }
        } catch (e) {
            // ç»§ç»­å°è¯•
        }
    }
    
    if (!workingPath) {
        resultDiv.innerHTML = `
            <p class="text-red-500">âŒ æ— æ³•æ‰¾åˆ°å¯ç”¨çš„JSæ–‡ä»¶è·¯å¾„ï¼</p>
            <p class="text-yellow-500 mt-2">å»ºè®®ï¼š</p>
            <ol class="list-decimal list-inside text-sm text-gray-400 ml-4">
                <li>æ£€æŸ¥ js æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨äº workbench/ ç›®å½•ä¸‹</li>
                <li>æ£€æŸ¥ Cloudflare Pages çš„æ„å»ºè¾“å‡ºç›®å½•é…ç½®</li>
                <li>æ£€æŸ¥ GitHub ä»“åº“ä¸­æ–‡ä»¶æ˜¯å¦æ­£ç¡®æ¨é€</li>
            </ol>
        `;
        return;
    }
    
    resultDiv.innerHTML = `<p class="text-green-500">âœ… æ‰¾åˆ°å¯ç”¨è·¯å¾„: ${workingPath}</p><p class="text-yellow-500 mt-2">æ­£åœ¨åŠ è½½...</p>`;
    
    // åŠ¨æ€åŠ è½½è„šæœ¬
    const script = document.createElement('script');
    script.src = workingPath;
    script.onload = () => {
        const loaded = typeof window.WorkbenchConfig !== 'undefined';
        if (loaded) {
            resultDiv.innerHTML = `
                <p class="text-green-500">âœ… æˆåŠŸåŠ è½½å¹¶æŒ‚è½½åˆ° window.WorkbenchConfig</p>
                <p class="text-sm text-gray-400 mt-2">ç‰ˆæœ¬: ${window.WorkbenchConfig?.SYSTEM?.VERSION || 'æœªçŸ¥'}</p>
                <p class="text-sm text-green-400 mt-2">âœ“ æ¨èä½¿ç”¨è·¯å¾„: <code class="bg-gray-800 px-2 py-1 rounded">${workingPath}</code></p>
            `;
        } else {
            resultDiv.innerHTML = `
                <p class="text-yellow-500">âš ï¸ æ–‡ä»¶å·²åŠ è½½ä½†æ¨¡å—æœªæŒ‚è½½åˆ°windowå¯¹è±¡</p>
                <p class="text-sm text-gray-400 mt-2">æ£€æŸ¥JSæ–‡ä»¶æœ«å°¾æ˜¯å¦æœ‰: window.WorkbenchConfig = WorkbenchConfig;</p>
            `;
        }
    };
    script.onerror = (e) => {
        resultDiv.innerHTML = `
            <p class="text-red-500">âŒ åŠ è½½å¤±è´¥ï¼</p>
            <p class="text-sm text-gray-400 mt-2">è·¯å¾„: ${workingPath}</p>
            <p class="text-sm text-gray-400">é”™è¯¯: ${e.message || 'æœªçŸ¥é”™è¯¯'}</p>
        `;
    };
    
    document.head.appendChild(script);
}

// é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æµ‹
window.addEventListener('load', () => {
    setTimeout(checkFiles, 500);
});
</script>
</body>
</html>
