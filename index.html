<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>战时指挥台 V14.2 PRO ERP EDITION · B2B 专用</title>
    
    <!-- 资源预加载策略：优先级从高到低 -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    
    <!-- 关键字体预加载 -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" as="style">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap">
    
    <!-- 核心样式库 -->
    <script src="https://cdn.tailwindcss.com" defer></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css" crossorigin>

    <!-- Tailwind 配置 -->
    <script>
        // 生产环境控制台输出控制
        const isProduction = !window.location.hostname.includes('localhost') && !window.location.hostname.includes('127.0.0.1');
        const log = isProduction ? () => {} : console.log;
        
        // Tailwind 主题配置
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#ef4444',
                        secondary: '#3b82f6',
                        accent: '#8b5cf6',
                        success: '#10b981',
                        warning: '#f59e0b',
                        info: '#06b6d4',
                        dark: '#1f2937',
                        darker: '#111827',
                        darkest: '#030712'
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'spin-smooth': 'spin 0.8s linear infinite',
                        'fade-in': 'fadeIn 0.3s ease-out forwards'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif']
                    },
                    transitionProperty: {
                        'width': 'width',
                        'transform': 'transform',
                        'opacity': 'opacity'
                    }
                }
            }
        }
    </script>

    <!-- 内联关键样式（首屏渲染必备） -->
    <style>
        /* 基础样式 */
        html { 
            scroll-behavior: smooth; 
            font-size: 16px;
        }
        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #030712;
            background-image:
                radial-gradient(circle at 10% 20%, rgba(31, 41, 55, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(31, 41, 55, 0.1) 0%, transparent 20%);
            background-attachment: fixed;
            min-height: 100vh;
            color: #fff;
        }

        /* 加载动画 */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 3px solid #ef4444;
            width: 50px;
            height: 50px;
            animation: spin 0.8s linear infinite;
            display: inline-block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { 
            animation: fadeIn 0.3s ease-out forwards; 
            animation-delay: calc(var(--animation-delay, 0) * 0.1s);
        }

        /* 标签页切换 */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.2s ease-out; }

        /* 移动端导航 */
        .mobile-nav-toggle {
            display: block;
            z-index: 50;
        }
        .mobile-nav {
            position: fixed;
            inset: 0;
            background-color: rgba(17, 24, 39, 0.98);
            z-index: 45;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            backdrop-filter: blur(8px);
        }
        .mobile-nav.active {
            transform: translateX(0);
        }
        .mobile-nav-content {
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 2rem 1.5rem;
            gap: 2rem;
            margin-top: 4rem;
            overflow-y: auto;
        }
        .mobile-nav-item {
            font-size: 1.25rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(75, 85, 99, 0.3);
            transition: color 0.2s ease;
        }
        .mobile-nav-item:hover {
            color: #ef4444;
        }

        /* 导航交互优化 */
        .nav-tab {
            position: relative;
            transition: color 0.2s ease;
        }
        .nav-tab::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: #ef4444;
            transition: width 0.2s ease;
        }
        .nav-tab:hover {
            color: #fff;
        }
        .nav-tab:hover::after {
            width: 100%;
        }

        /* 按钮交互增强 */
        .btn-transition {
            transition: all 0.2s ease;
        }
        .btn-transition:hover {
            transform: translateY(-2px);
        }

        /* 响应式适配 */
        @media (max-width: 768px) {
            .mobile-hide {
                display: none !important;
            }
            .mobile-show {
                display: block !important;
            }
        }
    </style>

    <!-- 基础路径初始化（首屏执行） -->
    <script>
        (function initBasePath() {
            // 自动检测基础路径
            window.WORKBENCH_BASE = window.location.pathname.includes('/workbench') ? '/workbench' : '';
            log('[Init] Base path initialized:', window.WORKBENCH_BASE);
            
            // 动态加载本地样式（非首屏关键样式）
            if (window.WORKBENCH_BASE) {
                const cssLink = document.createElement('link');
                cssLink.rel = 'stylesheet';
                cssLink.href = `${window.WORKBENCH_BASE}/css/workbench-v14.css`;
                cssLink.onload = () => log('[Style] Local CSS loaded successfully');
                cssLink.onerror = () => console.error('[Style] Failed to load local CSS');
                document.head.appendChild(cssLink);
            }
        })();
    </script>
</head>

<body class="min-h-screen text-white bg-darkest font-inter antialiased">
    <!-- 系统加载指示器 -->
    <div id="system-loading" class="fixed inset-0 z-50 bg-black/95 flex items-center justify-center">
        <div class="text-center max-w-md px-6 animate-fade-in" style="--animation-delay: 0">
            <div class="loading-spinner mx-auto mb-6"></div>
            <h2 class="text-2xl font-bold text-red-500 mb-3">系统初始化中</h2>
            <p class="text-gray-400 mb-4">正在加载核心模块...</p>
            <div id="loading-progress" class="text-sm text-gray-500 mb-3">准备加载...</div>
            <div id="loading-module" class="text-xs text-gray-600 mb-2"></div>
            
            <!-- 进度条 -->
            <div class="w-full bg-gray-800 rounded-full h-2 mb-4 overflow-hidden">
                <div id="loading-bar" class="bg-red-500 h-full w-0 transition-width duration-300"></div>
            </div>
            
            <!-- 错误提示 -->
            <div id="loading-error" class="hidden mt-6 p-4 bg-red-900/50 border border-red-500 rounded text-red-200 text-sm text-left max-h-60 overflow-y-auto">
                <div class="font-bold mb-2">加载错误</div>
                <div id="error-details"></div>
            </div>
            
            <!-- 重试按钮（默认隐藏） -->
            <button id="retry-loading" class="hidden mt-4 px-4 py-2 bg-red-600 rounded btn-transition hover:bg-red-700" onclick="location.reload()">
                <i class="fas fa-refresh mr-2"></i>重新加载
            </button>
        </div>
    </div>

    <!-- 铁幕登录界面 -->
    <section id="iron-curtain" class="fixed inset-0 z-50 bg-black flex items-center justify-center p-4 hidden">
        <div class="max-w-2xl w-full animate-fade-in" style="--animation-delay: 1">
            <div class="bg-gradient-to-br from-darker to-darkest border border-red-900/50 rounded-2xl p-8 shadow-2xl">
                <div class="text-center mb-8">
                    <div class="text-6xl mb-4 animate-pulse-slow">⚔️</div>
                    <h1 class="text-3xl font-black text-red-500 mb-2">SURVIVAL MODE</h1>
                    <p class="text-gray-400 text-lg">铁幕登录系统 - 今日战斗宣言</p>
                </div>

                <form class="space-y-6" onsubmit="app?.survival?.startBattle(); return false;">
                    <fieldset class="space-y-4">
                        <legend class="text-sm font-bold text-red-400 uppercase tracking-wider mb-2">
                            <i class="fas fa-fire mr-2"></i>今日三件事
                        </legend>

                        <div class="space-y-2">
                            <label for="action-1" class="block text-sm font-medium text-gray-300">
                                <span class="text-red-500">1.</span> 最重要的事
                            </label>
                            <input type="text" id="action-1" required
                                class="w-full px-4 py-3 bg-black border border-gray-800 rounded-lg focus:ring-2 focus:ring-red-600 focus:border-transparent transition-all"
                                placeholder="今天必须完成的第一件事"
                                oninput="app?.survival?.checkInputs()">
                        </div>

                        <div class="space-y-2">
                            <label for="action-2" class="block text-sm font-medium text-gray-300">
                                <span class="text-red-500">2.</span> 次要任务
                            </label>
                            <input type="text" id="action-2" required
                                class="w-full px-4 py-3 bg-black border border-gray-800 rounded-lg focus:ring-2 focus:ring-red-600 focus:border-transparent transition-all"
                                placeholder="今天需要推进的第二件事"
                                oninput="app?.survival?.checkInputs()">
                        </div>

                        <div class="space-y-2">
                            <label for="action-3" class="block text-sm font-medium text-gray-300">
                                <span class="text-red-500">3.</span> 日常维护
                            </label>
                            <input type="text" id="action-3" required
                                class="w-full px-4 py-3 bg-black border border-gray-800 rounded-lg focus:ring-2 focus:ring-red-600 focus:border-transparent transition-all"
                                placeholder="今天需要维护的第三件事"
                                oninput="app?.survival?.checkInputs()">
                        </div>
                    </fieldset>

                    <button type="submit" id="battle-start-btn" disabled
                        class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg btn-transition flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
                        <i class="fas fa-bolt"></i>
                        <span>开始战斗</span>
                    </button>
                </form>

                <div class="text-center mt-6">
                    <button onclick="app?.survival?.emergencyOverride()"
                        class="text-xs text-gray-500 hover:text-gray-300 transition-colors">
                        <i class="fas fa-exclamation-triangle mr-1 text-yellow-500"></i>
                        10分钟紧急进入
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- 紧急模式警告 -->
    <div id="emergency-mode-warning" class="fixed top-0 left-0 right-0 bg-red-900/90 text-white py-2 text-center text-sm font-bold z-50 hidden">
        ⚠️ 紧急模式已激活 (剩余 <span id="emergency-timer">10</span> 分钟)
    </div>

    <!-- 主应用界面 -->
    <main class="min-h-screen">
        <!-- 顶部导航栏 -->
        <header class="sticky top-0 z-40 bg-dark/80 backdrop-blur-md border-b border-gray-800">
            <div class="container mx-auto px-4">
                <div class="flex items-center justify-between h-16">
                    <!-- 品牌标识 -->
                    <div class="flex items-center gap-3">
                        <div class="text-2xl">⚔️</div>
                        <div>
                            <h1 class="text-lg font-bold text-red-500">战时指挥台 V14.2 PRO</h1>
                            <p class="text-xs text-gray-500 mobile-hide">B2B 专用 · 现金为王 · 云端同步</p>
                        </div>
                    </div>

                    <!-- 桌面端导航 -->
                    <nav class="hidden md:flex items-center gap-6 mobile-hide">
                        <button onclick="app.switchTab('dashboard')" class="nav-tab text-gray-300 flex items-center gap-2">
                            <i class="fas fa-tachometer-alt"></i><span>仪表盘</span>
                        </button>
                        <button onclick="app.switchTab('kanban')" class="nav-tab text-gray-300 flex items-center gap-2">
                            <i class="fas fa-tasks"></i><span>订单战场</span>
                        </button>
                        <button onclick="app.switchTab('crm')" class="nav-tab text-gray-300 flex items-center gap-2">
                            <i class="fas fa-users"></i><span>客户档案</span>
                        </button>
                        <button onclick="app.switchTab('suppliers')" class="nav-tab text-gray-300 flex items-center gap-2">
                            <i class="fas fa-industry"></i><span>供应商</span>
                        </button>
                        <button onclick="app.switchTab('expenses')" class="nav-tab text-gray-300 flex items-center gap-2">
                            <i class="fas fa-money-bill-wave"></i><span>运营支出</span>
                        </button>
                    </nav>

                    <!-- 移动端导航切换按钮 -->
                    <button class="md:hidden mobile-nav-toggle p-2 rounded-full hover:bg-gray-800 transition-colors mobile-show" 
                            onclick="document.querySelector('.mobile-nav').classList.toggle('active')">
                        <i class="fas fa-bars text-gray-400 hover:text-white"></i>
                    </button>

                    <!-- 右侧操作区 -->
                    <div class="flex items-center gap-3">
                        <div id="sync-status" class="flex items-center gap-2 px-3 py-1 bg-gray-800 rounded-full text-xs mobile-hide">
                            <i class="fas fa-cloud text-gray-400"></i>
                            <span class="text-gray-400">离线</span>
                        </div>
                        <button onclick="app.openSettings?.()" class="p-2 rounded-full hover:bg-gray-800 transition-colors btn-transition">
                            <i class="fas fa-cog text-gray-400 hover:text-white"></i>
                        </button>
                        <button onclick="app.logout?.()" class="p-2 rounded-full hover:bg-gray-800 transition-colors btn-transition">
                            <i class="fas fa-sign-out-alt text-gray-400 hover:text-white"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- 移动端导航菜单 -->
        <div class="mobile-nav">
            <div class="mobile-nav-content">
                <button onclick="app.switchTab('dashboard'); document.querySelector('.mobile-nav').classList.remove('active')" 
                        class="mobile-nav-item text-gray-300 hover:text-white transition-colors flex items-center gap-2">
                    <i class="fas fa-tachometer-alt"></i><span>仪表盘</span>
                </button>
                <button onclick="app.switchTab('kanban'); document.querySelector('.mobile-nav').classList.remove('active')" 
                        class="mobile-nav-item text-gray-300 hover:text-white transition-colors flex items-center gap-2">
                    <i class="fas fa-tasks"></i><span>订单战场</span>
                </button>
                <button onclick="app.switchTab('crm'); document.querySelector('.mobile-nav').classList.remove('active')" 
                        class="mobile-nav-item text-gray-300 hover:text-white transition-colors flex items-center gap-2">
                    <i class="fas fa-users"></i><span>客户档案</span>
                </button>
                <button onclick="app.switchTab('suppliers'); document.querySelector('.mobile-nav').classList.remove('active')" 
                        class="mobile-nav-item text-gray-300 hover:text-white transition-colors flex items-center gap-2">
                    <i class="fas fa-industry"></i><span>供应商</span>
                </button>
                <button onclick="app.switchTab('expenses'); document.querySelector('.mobile-nav').classList.remove('active')" 
                        class="mobile-nav-item text-gray-300 hover:text-white transition-colors flex items-center gap-2">
                    <i class="fas fa-money-bill-wave"></i><span>运营支出</span>
                </button>
            </div>
        </div>

        <!-- 今日三件事 Banner -->
        <div id="today-actions-banner" class="bg-gradient-to-r from-red-900 to-red-800 py-4 px-6 border-b border-red-700/50 hidden">
            <div class="container mx-auto">
                <div class="flex items-center justify-between">
                    <h3 class="text-white font-bold flex items-center gap-2">
                        <i class="fas fa-fire text-yellow-400"></i>今日三件事
                    </h3>
                    <button onclick="app.clearTodayActions?.()" class="text-xs text-red-200 hover:text-white transition-colors btn-transition">
                        <i class="fas fa-redo-alt mr-1"></i>重新设置
                    </button>
                </div>
                <div id="today-actions-list" class="mt-2 space-y-1"></div>
            </div>
        </div>

        <!-- 标签页内容区域 -->
        <div class="container mx-auto px-4 py-6">
            <!-- 仪表盘 -->
            <div id="tab-dashboard" class="tab-content active">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl p-6 shadow-lg btn-transition">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-white/80 text-sm font-medium">总订单数</h3>
                            <i class="fas fa-shopping-cart text-white/60 text-2xl"></i>
                        </div>
                        <p id="dashboard-total-orders" class="text-3xl font-bold text-white">0</p>
                        <p class="text-white/70 text-xs mt-1">活跃订单</p>
                    </div>

                    <div class="bg-gradient-to-br from-green-600 to-green-700 rounded-xl p-6 shadow-lg btn-transition">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-white/80 text-sm font-medium">总收入</h3>
                            <i class="fas fa-dollar-sign text-white/60 text-2xl"></i>
                        </div>
                        <p id="dashboard-total-income" class="text-3xl font-bold text-white">¥0</p>
                        <p class="text-white/70 text-xs mt-1">累计收入</p>
                    </div>

                    <div class="bg-gradient-to-br from-purple-600 to-purple-700 rounded-xl p-6 shadow-lg btn-transition">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-white/80 text-sm font-medium">本月收入</h3>
                            <i class="fas fa-chart-line text-white/60 text-2xl"></i>
                        </div>
                        <p id="dashboard-month-income" class="text-3xl font-bold text-white">¥0</p>
                        <p class="text-white/70 text-xs mt-1">当月统计</p>
                    </div>

                    <div class="bg-gradient-to-br from-orange-600 to-orange-700 rounded-xl p-6 shadow-lg btn-transition">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-white/80 text-sm font-medium">供应商数</h3>
                            <i class="fas fa-truck text-white/60 text-2xl"></i>
                        </div>
                        <p id="dashboard-total-suppliers" class="text-3xl font-bold text-white">0</p>
                        <p class="text-white/70 text-xs mt-1">合作伙伴</p>
                    </div>
                </div>

                <!-- 实时时钟 -->
                <div class="bg-gray-900 rounded-xl p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="text-center">
                            <p class="text-gray-400 text-sm mb-1">当前时间</p>
                            <p id="current-time" class="text-2xl font-bold text-white">--:--:--</p>
                        </div>
                        <div class="text-center">
                            <p class="text-gray-400 text-sm mb-1">系统状态</p>
                            <p class="text-green-500 font-bold">● 运行中</p>
                        </div>
                        <div class="text-center">
                            <p class="text-gray-400 text-sm mb-1">云端同步</p>
                            <p id="last-sync" class="text-gray-300">未连接</p>
                        </div>
                    </div>
                </div>

                <!-- 快速操作 -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <button onclick="app.kanban?.openQuickAdd()"
                        class="bg-gradient-to-br from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 p-6 rounded-xl transition-all text-left btn-transition">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-plus-circle text-3xl text-white/80"></i>
                            <i class="fas fa-arrow-right text-white/50"></i>
                        </div>
                        <h3 class="text-white font-bold text-lg">新增订单</h3>
                        <p class="text-white/70 text-sm mt-1">快速创建新订单</p>
                    </button>

                    <button onclick="app.crm?.openCustomerModal()"
                        class="bg-gradient-to-br from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 p-6 rounded-xl transition-all text-left btn-transition">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-user-plus text-3xl text-white/80"></i>
                            <i class="fas fa-arrow-right text-white/50"></i>
                        </div>
                        <h3 class="text-white font-bold text-lg">新增客户</h3>
                        <p class="text-white/70 text-sm mt-1">添加客户信息</p>
                    </button>

                    <button onclick="app.expenses?.openAddModal()"
                        class="bg-gradient-to-br from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 p-6 rounded-xl transition-all text-left btn-transition">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-receipt text-3xl text-white/80"></i>
                            <i class="fas fa-arrow-right text-white/50"></i>
                        </div>
                        <h3 class="text-white font-bold text-lg">记录支出</h3>
                        <p class="text-white/70 text-sm mt-1">添加运营费用</p>
                    </button>
                </div>
            </div>

            <!-- 订单战场 -->
            <div id="tab-kanban" class="tab-content">
                <div class="mb-6 flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-white">订单战场</h2>
                    <button onclick="app.kanban?.openQuickAdd()"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 btn-transition">
                        <i class="fas fa-plus"></i><span>快速新增</span>
                    </button>
                </div>
                <div id="kanban-board" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4"></div>
            </div>

            <!-- 客户档案 -->
            <div id="tab-crm" class="tab-content">
                <div class="mb-6 flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-white">客户档案</h2>
                    <button onclick="app.crm?.openCustomerModal()"
                        class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 btn-transition">
                        <i class="fas fa-user-plus"></i><span>新增客户</span>
                    </button>
                </div>
                <div id="crm-customers" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fas fa-users text-4xl mb-4 opacity-50"></i>
                        <p>暂无客户数据</p>
                    </div>
                </div>
            </div>

            <!-- 供应商 -->
            <div id="tab-suppliers" class="tab-content">
                <div class="mb-6 flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-white">供应商管理</h2>
                    <button onclick="app.suppliers?.openAddModal()"
                        class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 btn-transition">
                        <i class="fas fa-industry"></i><span>新增供应商</span>
                    </button>
                </div>
                <div id="suppliers-list" class="space-y-4">
                    <div class="text-center py-12 text-gray-500">
                        <i class="fas fa-industry text-4xl mb-4 opacity-50"></i>
                        <p>暂无供应商数据</p>
                    </div>
                </div>
            </div>

            <!-- 运营支出 -->
            <div id="tab-expenses" class="tab-content">
                <div class="mb-6 flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-white">运营支出</h2>
                    <button onclick="app.expenses?.openAddModal()"
                        class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 btn-transition">
                        <i class="fas fa-plus"></i><span>记录支出</span>
                    </button>
                </div>
                <div id="expenses-list" class="space-y-4">
                    <div class="text-center py-12 text-gray-500">
                        <i class="fas fa-receipt text-4xl mb-4 opacity-50"></i>
                        <p>暂无支出记录</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 核心工具函数 -->
    <script>
        // 加载进度更新
        window.updateLoadingProgress = function(progress, moduleName) {
            const progressEl = document.getElementById('loading-progress');
            const moduleEl = document.getElementById('loading-module');
            const barEl = document.getElementById('loading-bar');
            
            if (progressEl) progressEl.textContent = `加载进度: ${progress}%`;
            if (moduleEl) moduleEl.textContent = moduleName ? `当前加载: ${moduleName}` : '';
            if (barEl) barEl.style.width = `${progress}%`;
        };

        // 模块加载检查
        window.checkModulesLoaded = function() {
            const requiredModules = [
                'WorkbenchConfig', 'WorkbenchUtils', 'WorkbenchModal',
                'WorkbenchState', 'WorkbenchStorage', 'WorkbenchAuth',
                'WorkbenchDashboard', 'WorkbenchOrders', 'WorkbenchSuppliers',
                'WorkbenchFinance', 'WorkbenchExpenses', 'WorkbenchCRM', 'app'
            ];
            
            const missing = requiredModules.filter(mod => typeof window[mod] === 'undefined');
            if (missing.length > 0) {
                if (!isProduction) console.error('[Loader] Missing modules:', missing);
                return { allLoaded: false, missing };
            }
            return { allLoaded: true, missing: [] };
        };

        // 实时时钟
        function updateClock() {
            const now = new Date();
            const timeStr = now.toTimeString().split(' ')[0];
            const timeEl = document.getElementById('current-time');
            if (timeEl) timeEl.textContent = timeStr;
        }
        setInterval(updateClock, 1000);
        updateClock();
    </script>

    <!-- 模块化加载器（统一管理脚本加载） -->
    <script>
        (function loadCoreModules() {
            // 模块清单（区分本地/远程）
            const moduleManifest = [
                // 本地核心模块
                { src: '/js/workbench-config.js', type: 'local' },
                { src: '/js/workbench-utils.js', type: 'local' },
                { src: '/js/workbench-modal.js', type: 'local' },
                { src: '/js/workbench-state.js', type: 'local' },
                { src: '/js/workbench-storage.js', type: 'local' },
                { src: '/js/workbench-auth.js', type: 'local' },
                
                // Firebase 远程模块
                { src: 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js', type: 'remote' },
                { src: 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js', type: 'remote' },
                { src: 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js', type: 'remote' },
                { src: 'https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js', type: 'remote' },
                
                // 业务模块
                { src: '/js/workbench-firebase.js', type: 'local' },
                { src: '/js/workbench-dashboard.js', type: 'local' },
                { src: '/js/workbench-orders.js', type: 'local' },
                { src: '/js/workbench-suppliers.js', type: 'local' },
                { src: '/js/workbench-finance.js', type: 'local' },
                { src: '/js/workbench-expenses.js', type: 'local' },
                { src: '/js/workbench-crm.js', type: 'local' },
                
                // 主应用
                { src: '/js/workbench-app.js', type: 'local' }
            ];

            let loadedCount = 0;
            const totalModules = moduleManifest.length;
            const loadTimeout = 20000; // 20秒超时
            let timeoutTimer = null;

            // 超时处理
            function handleLoadTimeout() {
                const errorEl = document.getElementById('loading-error');
                const errorDetails = document.getElementById('error-details');
                const retryBtn = document.getElementById('retry-loading');
                
                updateLoadingProgress(0, '加载超时');
                if (errorEl) errorEl.classList.remove('hidden');
                if (errorDetails) errorDetails.textContent = '模块加载超时，请检查网络连接或刷新页面重试';
                if (retryBtn) retryBtn.classList.remove('hidden');
                
                if (!isProduction) console.error('[Loader] Module loading timeout');
            }

            // 启动超时定时器
            timeoutTimer = setTimeout(handleLoadTimeout, loadTimeout);

            // 加载单个模块
            function loadModule(module) {
                const moduleName = module.src.split('/').pop();
                updateLoadingProgress(Math.round((loadedCount / totalModules) * 100), moduleName);
                
                // 构建完整URL
                const fullSrc = module.type === 'local' 
                    ? `${window.WORKBENCH_BASE}${module.src}` 
                    : module.src;

                const script = document.createElement('script');
                script.src = fullSrc;
                script.async = false; // 顺序加载
                script.crossOrigin = 'anonymous';

                // 加载成功
                script.onload = function() {
                    loadedCount++;
                    updateLoadingProgress(
                        Math.round((loadedCount / totalModules) * 100), 
                        `${moduleName} ✅`
                    );
                    
                    // 所有模块加载完成
                    if (loadedCount === totalModules) {
                        clearTimeout(timeoutTimer);
                        updateLoadingProgress(100, '所有模块加载完成');
                        initAppAfterLoad();
                    }
                };

                // 加载失败
                script.onerror = function() {
                    clearTimeout(timeoutTimer);
                    const errorEl = document.getElementById('loading-error');
                    const errorDetails = document.getElementById('error-details');
                    const retryBtn = document.getElementById('retry-loading');
                    
                    if (errorEl) errorEl.classList.remove('hidden');
                    if (errorDetails) {
                        errorDetails.innerHTML += `<p>❌ 加载失败: ${moduleName} (${fullSrc})</p>`;
                    }
                    if (retryBtn) retryBtn.classList.remove('hidden');
                    
                    updateLoadingProgress(0, `加载失败: ${moduleName}`);
                    if (!isProduction) console.error('[Loader] Failed to load:', fullSrc);
                };

                document.body.appendChild(script);
            }

            // 应用初始化（模块加载完成后）
            function initAppAfterLoad() {
                const { allLoaded, missing } = checkModulesLoaded();
                
                if (allLoaded) {
                    // 隐藏加载界面
                    const loadingEl = document.getElementById('system-loading');
                    if (loadingEl) {
                        loadingEl.style.opacity = '0';
                        loadingEl.style.transition = 'opacity 0.3s ease';
                        setTimeout(() => {
                            loadingEl.style.display = 'none';
                            // 启动应用
                            if (typeof app?.init === 'function') {
                                log('[App] Initializing application...');
                                app.init();
                            }
                        }, 300);
                    }
                } else {
                    // 模块缺失处理
                    const errorEl = document.getElementById('loading-error');
                    const errorDetails = document.getElementById('error-details');
                    const retryBtn = document.getElementById('retry-loading');
                    
                    if (errorEl) errorEl.classList.remove('hidden');
                    if (errorDetails) {
                        errorDetails.innerHTML = `
                            <p>❌ 核心模块缺失: ${missing.join(', ')}</p>
                            <p>可能原因：</p>
                            <ul class="list-disc pl-4 mt-2">
                                <li>JS文件路径配置错误</li>
                                <li>服务器部署路径问题</li>
                                <li>网络连接异常</li>
                            </ul>
                        `;
                    }
                    if (retryBtn) retryBtn.classList.remove('hidden');
                    
                    updateLoadingProgress(0, '模块验证失败');
                }
            }

            // 开始加载所有模块
            moduleManifest.forEach(loadModule);
        })();
    </script>
</body>
</html>
