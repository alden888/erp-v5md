<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æˆ˜æ—¶æŒ‡æŒ¥å° V14.2 PRO ERP EDITION Â· B2B ä¸“ç”¨</title>

<!-- é¢„åŠ è½½å…³é”®èµ„æº -->
<link rel="preconnect" href="https://cdn.tailwindcss.com">
<link rel="preconnect" href="https://cdn.jsdelivr.net">

<!-- å¤–éƒ¨æ ·å¼ -->
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">

<!-- Tailwind é…ç½® -->
<script>
tailwind.config = {
theme: {
extend: {
colors: {
primary: '#ef4444',
secondary: '#3b82f6',
accent: '#8b5cf6',
success: '#10b981',
warning: '#f59e0b',
info: '#06b6d4',
dark: '#1f2937',
darker: '#111827',
darkest: '#030712'
}
}
}
}
</script>

<!-- å†…è”å…³é”® CSS -->
<style>
html { scroll-behavior: smooth; }
body {
font-family: 'Inter', system-ui, sans-serif;
background-color: #030712;
background-image:
radial-gradient(circle at 10% 20%, rgba(31, 41, 55, 0.1) 0%, transparent 20%),
radial-gradient(circle at 90% 80%, rgba(31, 41, 55, 0.1) 0%, transparent 20%);
background-attachment: fixed;
}

/* åŠ è½½åŠ¨ç”» */
@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
.loading-spinner {
border: 2px solid rgba(255, 255, 255, 0.1);
border-radius: 50%;
border-top: 2px solid #ef4444;
width: 20px;
height: 20px;
animation: spin 1s linear infinite;
display: inline-block;
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}
.animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }

.tab-content { display: none; }
.tab-content.active { display: block; }
</style>

<!-- æœ¬åœ°æ ·å¼æ–‡ä»¶ -->
<link rel="stylesheet" href="css/workbench-v14.css">
</head>
<body class="min-h-screen text-white bg-darkest">

<!-- ğŸ”¥ ç³»ç»ŸåŠ è½½æŒ‡ç¤ºå™¨ -->
<div id="system-loading" class="fixed inset-0 z-50 bg-black/90 flex items-center justify-center">
<div class="text-center max-w-md">
<div class="loading-spinner mx-auto mb-4" style="width: 40px; height: 40px;"></div>
<h2 class="text-xl font-bold text-red-500 mb-2">ç³»ç»Ÿåˆå§‹åŒ–ä¸­...</h2>
<p class="text-gray-400 mb-4">æ­£åœ¨åŠ è½½æ ¸å¿ƒæ¨¡å—...</p>
<div id="loading-progress" class="text-sm text-gray-500 mb-2">æ£€æµ‹æ–‡ä»¶è·¯å¾„...</div>
<div id="loading-details" class="text-xs text-gray-600 max-h-40 overflow-y-auto"></div>
<div id="loading-error" class="hidden mt-4 p-4 bg-red-900/50 border border-red-500 rounded text-red-200 text-sm text-left"></div>
</div>
</div>

<!-- ğŸ”¥ é“å¹•ç™»å½•ç•Œé¢ -->
<section id="iron-curtain" class="fixed inset-0 z-50 bg-black flex items-center justify-center p-4 hidden">
<div class="max-w-2xl w-full animate-fade-in">
<div class="bg-gradient-to-br from-darker to-darkest border border-red-900/50 rounded-2xl p-8 shadow-2xl">
<div class="text-center mb-8">
<div class="text-6xl mb-4 animate-pulse-slow">âš”ï¸</div>
<h1 class="text-3xl font-black text-red-500 mb-2">SURVIVAL MODE</h1>
<p class="text-gray-400 text-lg">é“å¹•ç™»å½•ç³»ç»Ÿ - ä»Šæ—¥æˆ˜æ–—å®£è¨€</p>
</div>

<form class="space-y-6" onsubmit="app.survival.startBattle(); return false;">
<fieldset class="space-y-4">
<legend class="text-sm font-bold text-red-400 uppercase tracking-wider mb-2">
<i class="fas fa-fire mr-2"></i>ä»Šæ—¥ä¸‰ä»¶äº‹
</legend>

<div class="space-y-2">
<label for="action-1" class="block text-sm font-medium text-gray-300">
<span class="text-red-500">1.</span> æœ€é‡è¦çš„äº‹
</label>
<input type="text" id="action-1" required
class="w-full px-4 py-3 bg-black border border-gray-800 rounded-lg focus:ring-2 focus:ring-red-600 focus:border-transparent transition-all"
placeholder="ä»Šå¤©å¿…é¡»å®Œæˆçš„ç¬¬ä¸€ä»¶äº‹"
oninput="app.survival.checkInputs()">
</div>

<div class="space-y-2">
<label for="action-2" class="block text-sm font-medium text-gray-300">
<span class="text-red-500">2.</span> æ¬¡è¦ä»»åŠ¡
</label>
<input type="text" id="action-2" required
class="w-full px-4 py-3 bg-black border border-gray-800 rounded-lg focus:ring-2 focus:ring-red-600 focus:border-transparent transition-all"
placeholder="ä»Šå¤©éœ€è¦æ¨è¿›çš„ç¬¬äºŒä»¶äº‹"
oninput="app.survival.checkInputs()">
</div>

<div class="space-y-2">
<label for="action-3" class="block text-sm font-medium text-gray-300">
<span class="text-red-500">3.</span> æ—¥å¸¸ç»´æŠ¤
</label>
<input type="text" id="action-3" required
class="w-full px-4 py-3 bg-black border border-gray-800 rounded-lg focus:ring-2 focus:ring-red-600 focus:border-transparent transition-all"
placeholder="ä»Šå¤©éœ€è¦ç»´æŠ¤çš„ç¬¬ä¸‰ä»¶äº‹"
oninput="app.survival.checkInputs()">
</div>
</fieldset>

<button type="submit" id="battle-start-btn" disabled
class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
<i class="fas fa-bolt"></i>
<span>å¼€å§‹æˆ˜æ–—</span>
</button>
</form>

<div class="text-center mt-6">
<button onclick="app.survival.emergencyOverride()"
class="text-xs text-gray-500 hover:text-gray-300 transition-colors">
<i class="fas fa-exclamation-triangle mr-1 text-yellow-500"></i>
10åˆ†é’Ÿç´§æ€¥è¿›å…¥
</button>
</div>
</div>
</div>
</section>

<!-- ğŸ”¥ ç´§æ€¥æ¨¡å¼è­¦å‘Š -->
<div id="emergency-mode-warning" class="fixed top-0 left-0 right-0 bg-red-900/90 text-white py-2 text-center text-sm font-bold z-50 hidden">
âš ï¸ ç´§æ€¥æ¨¡å¼å·²æ¿€æ´» (å‰©ä½™ <span id="emergency-timer">10</span> åˆ†é’Ÿ)
</div>

<!-- ğŸ”¥ ä¸»åº”ç”¨ç•Œé¢ -->
<main class="min-h-screen">
<!-- é¡¶éƒ¨å¯¼èˆªæ  -->
<header class="sticky top-0 z-40 bg-dark/80 backdrop-blur-md border-b border-gray-800">
<div class="container mx-auto px-4">
<div class="flex items-center justify-between h-16">
<div class="flex items-center gap-3">
<div class="text-2xl">âš”ï¸</div>
<div>
<h1 class="text-lg font-bold text-red-500">æˆ˜æ—¶æŒ‡æŒ¥å° V14.2 PRO</h1>
<p class="text-xs text-gray-500">B2B ä¸“ç”¨ Â· ç°é‡‘ä¸ºç‹ Â· äº‘ç«¯åŒæ­¥</p>
</div>
</div>

<nav class="hidden md:flex items-center gap-6">
<button onclick="app.switchTab('dashboard')" class="nav-tab text-gray-300 hover:text-white transition-colors flex items-center gap-2">
<i class="fas fa-tachometer-alt"></i><span>ä»ªè¡¨ç›˜</span>
</button>
<button onclick="app.switchTab('kanban')" class="nav-tab text-gray-300 hover:text-white transition-colors flex items-center gap-2">
<i class="fas fa-tasks"></i><span>è®¢å•æˆ˜åœº</span>
</button>
<button onclick="app.switchTab('crm')" class="nav-tab text-gray-300 hover:text-white transition-colors flex items-center gap-2">
<i class="fas fa-users"></i><span>å®¢æˆ·æ¡£æ¡ˆ</span>
</button>
<button onclick="app.switchTab('suppliers')" class="nav-tab text-gray-300 hover:text-white transition-colors flex items-center gap-2">
<i class="fas fa-industry"></i><span>ä¾›åº”å•†</span>
</button>
<button onclick="app.switchTab('expenses')" class="nav-tab text-gray-300 hover:text-white transition-colors flex items-center gap-2">
<i class="fas fa-money-bill-wave"></i><span>è¿è¥æ”¯å‡º</span>
</button>
</nav>

<div class="flex items-center gap-3">
<div id="sync-status" class="flex items-center gap-2 px-3 py-1 bg-gray-800 rounded-full text-xs">
<i class="fas fa-cloud text-gray-400"></i>
<span class="text-gray-400">ç¦»çº¿</span>
</div>
<button onclick="app.openSettings()" class="p-2 rounded-full hover:bg-gray-800 transition-colors">
<i class="fas fa-cog text-gray-400 hover:text-white"></i>
</button>
<button onclick="app.logout()" class="p-2 rounded-full hover:bg-gray-800 transition-colors">
<i class="fas fa-sign-out-alt text-gray-400 hover:text-white"></i>
</button>
</div>
</div>
</div>
</header>

<!-- ä»Šæ—¥ä¸‰ä»¶äº‹ Banner -->
<div id="today-actions-banner" class="bg-gradient-to-r from-red-900 to-red-800 py-4 px-6 border-b border-red-700/50 hidden">
<div class="container mx-auto">
<div class="flex items-center justify-between">
<h3 class="text-white font-bold flex items-center gap-2">
<i class="fas fa-fire text-yellow-400"></i>ä»Šæ—¥ä¸‰ä»¶äº‹
</h3>
<button onclick="app.clearTodayActions()" class="text-xs text-red-200 hover:text-white transition-colors">
<i class="fas fa-redo-alt mr-1"></i>é‡æ–°è®¾ç½®
</button>
</div>
<div id="today-actions-list" class="mt-2 space-y-1"></div>
</div>
</div>

<!-- æ ‡ç­¾é¡µå†…å®¹åŒºåŸŸ -->
<div class="container mx-auto px-4 py-6">
<!-- ä»ªè¡¨ç›˜ -->
<div id="tab-dashboard" class="tab-content active">
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
<div class="bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl p-6 shadow-lg">
<div class="flex items-center justify-between mb-2">
<h3 class="text-white/80 text-sm font-medium">æ€»è®¢å•æ•°</h3>
<i class="fas fa-shopping-cart text-white/60 text-2xl"></i>
</div>
<p id="dashboard-total-orders" class="text-3xl font-bold text-white">0</p>
<p class="text-white/70 text-xs mt-1">æ´»è·ƒè®¢å•</p>
</div>

<div class="bg-gradient-to-br from-green-600 to-green-700 rounded-xl p-6 shadow-lg">
<div class="flex items-center justify-between mb-2">
<h3 class="text-white/80 text-sm font-medium">æ€»æ”¶å…¥</h3>
<i class="fas fa-dollar-sign text-white/60 text-2xl"></i>
</div>
<p id="dashboard-total-income" class="text-3xl font-bold text-white">Â¥0</p>
<p class="text-white/70 text-xs mt-1">ç´¯è®¡æ”¶å…¥</p>
</div>

<div class="bg-gradient-to-br from-purple-600 to-purple-700 rounded-xl p-6 shadow-lg">
<div class="flex items-center justify-between mb-2">
<h3 class="text-white/80 text-sm font-medium">æœ¬æœˆæ”¶å…¥</h3>
<i class="fas fa-chart-line text-white/60 text-2xl"></i>
</div>
<p id="dashboard-month-income" class="text-3xl font-bold text-white">Â¥0</p>
<p class="text-white/70 text-xs mt-1">å½“æœˆç»Ÿè®¡</p>
</div>

<div class="bg-gradient-to-br from-orange-600 to-orange-700 rounded-xl p-6 shadow-lg">
<div class="flex items-center justify-between mb-2">
<h3 class="text-white/80 text-sm font-medium">ä¾›åº”å•†æ•°</h3>
<i class="fas fa-truck text-white/60 text-2xl"></i>
</div>
<p id="dashboard-total-suppliers" class="text-3xl font-bold text-white">0</p>
<p class="text-white/70 text-xs mt-1">åˆä½œä¼™ä¼´</p>
</div>
</div>

<!-- å®æ—¶æ—¶é’Ÿ -->
<div class="bg-gray-900 rounded-xl p-6 mb-6">
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
<div class="text-center">
<p class="text-gray-400 text-sm mb-1">å½“å‰æ—¶é—´</p>
<p id="current-time" class="text-2xl font-bold text-white">--:--:--</p>
</div>
<div class="text-center">
<p class="text-gray-400 text-sm mb-1">ç³»ç»ŸçŠ¶æ€</p>
<p class="text-green-500 font-bold">â— è¿è¡Œä¸­</p>
</div>
<div class="text-center">
<p class="text-gray-400 text-sm mb-1">äº‘ç«¯åŒæ­¥</p>
<p id="last-sync" class="text-gray-300">æœªè¿æ¥</p>
</div>
</div>
</div>

<!-- å¿«é€Ÿæ“ä½œ -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
<button onclick="app.kanban.openQuickAdd()"
class="bg-gradient-to-br from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 p-6 rounded-xl transition-all text-left group">
<div class="flex items-center justify-between mb-2">
<i class="fas fa-plus-circle text-3xl text-white/80 group-hover:scale-110 transition-transform"></i>
<i class="fas fa-arrow-right text-white/50 group-hover:translate-x-1 transition-transform"></i>
</div>
<h3 class="text-white font-bold text-lg">æ–°å¢è®¢å•</h3>
<p class="text-white/70 text-sm mt-1">å¿«é€Ÿåˆ›å»ºæ–°è®¢å•</p>
</button>

<button onclick="app.crm.openCustomerModal()"
class="bg-gradient-to-br from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 p-6 rounded-xl transition-all text-left group">
<div class="flex items-center justify-between mb-2">
<i class="fas fa-user-plus text-3xl text-white/80 group-hover:scale-110 transition-transform"></i>
<i class="fas fa-arrow-right text-white/50 group-hover:translate-x-1 transition-transform"></i>
</div>
<h3 class="text-white font-bold text-lg">æ–°å¢å®¢æˆ·</h3>
<p class="text-white/70 text-sm mt-1">æ·»åŠ å®¢æˆ·ä¿¡æ¯</p>
</button>

<button onclick="app.expenses.openAddModal()"
class="bg-gradient-to-br from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 p-6 rounded-xl transition-all text-left group">
<div class="flex items-center justify-between mb-2">
<i class="fas fa-receipt text-3xl text-white/80 group-hover:scale-110 transition-transform"></i>
<i class="fas fa-arrow-right text-white/50 group-hover:translate-x-1 transition-transform"></i>
</div>
<h3 class="text-white font-bold text-lg">è®°å½•æ”¯å‡º</h3>
<p class="text-white/70 text-sm mt-1">æ·»åŠ è¿è¥è´¹ç”¨</p>
</button>
</div>
</div>

<!-- è®¢å•æˆ˜åœº -->
<div id="tab-kanban" class="tab-content">
<div class="mb-6 flex items-center justify-between">
<h2 class="text-2xl font-bold text-white">è®¢å•æˆ˜åœº</h2>
<button onclick="app.kanban.openQuickAdd()"
class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
<i class="fas fa-plus"></i><span>å¿«é€Ÿæ–°å¢</span>
</button>
</div>
<div id="kanban-board" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4"></div>
</div>

<!-- å®¢æˆ·æ¡£æ¡ˆ -->
<div id="tab-crm" class="tab-content">
<div class="mb-6 flex items-center justify-between">
<h2 class="text-2xl font-bold text-white">å®¢æˆ·æ¡£æ¡ˆ</h2>
<button onclick="app.crm.openCustomerModal()"
class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
<i class="fas fa-user-plus"></i><span>æ–°å¢å®¢æˆ·</span>
</button>
</div>
<div id="crm-customers" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
<div class="col-span-full text-center py-12 text-gray-500">
<i class="fas fa-users text-4xl mb-4 opacity-50"></i>
<p>æš‚æ— å®¢æˆ·æ•°æ®</p>
</div>
</div>
</div>

<!-- ä¾›åº”å•† -->
<div id="tab-suppliers" class="tab-content">
<div class="mb-6 flex items-center justify-between">
<h2 class="text-2xl font-bold text-white">ä¾›åº”å•†ç®¡ç†</h2>
<button onclick="app.suppliers.openAddModal()"
class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
<i class="fas fa-industry"></i><span>æ–°å¢ä¾›åº”å•†</span>
</button>
</div>
<div id="suppliers-list" class="space-y-4">
<div class="text-center py-12 text-gray-500">
<i class="fas fa-industry text-4xl mb-4 opacity-50"></i>
<p>æš‚æ— ä¾›åº”å•†æ•°æ®</p>
</div>
</div>
</div>

<!-- è¿è¥æ”¯å‡º -->
<div id="tab-expenses" class="tab-content">
<div class="mb-6 flex items-center justify-between">
<h2 class="text-2xl font-bold text-white">è¿è¥æ”¯å‡º</h2>
<button onclick="app.expenses.openAddModal()"
class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
<i class="fas fa-plus"></i><span>è®°å½•æ”¯å‡º</span>
</button>
</div>
<div id="expenses-list" class="space-y-4">
<div class="text-center py-12 text-gray-500">
<i class="fas fa-receipt text-4xl mb-4 opacity-50"></i>
<p>æš‚æ— æ”¯å‡ºè®°å½•</p>
</div>
</div>
</div>
</div>
</main>

<!-- ğŸ”¥ æ™ºèƒ½æ¨¡å—åŠ è½½å™¨ -->
<script>
(function() {
'use strict';

// æ¨¡å—åŠ è½½é”™è¯¯è®°å½•
window.moduleLoadErrors = [];
const loadedModules = new Set();
const failedModules = new Set();

// æ›´æ–°åŠ è½½è¿›åº¦
function updateProgress(message, isError = false) {
const detailsEl = document.getElementById('loading-details');
if (detailsEl) {
const timestamp = new Date().toLocaleTimeString();
const color = isError ? 'text-red-400' : 'text-gray-500';
detailsEl.innerHTML = `<div class="${color}">[${timestamp}] ${message}</div>` + detailsEl.innerHTML;
}
}

// æ˜¾ç¤ºé”™è¯¯
function showError(title, messages) {
const errorDiv = document.getElementById('loading-error');
if (errorDiv) {
errorDiv.classList.remove('hidden');
errorDiv.innerHTML = `
<strong>${title}</strong><br>
${messages.map(m => `â€¢ ${m}`).join('<br>')}<br>
<button onclick="location.reload()" class="mt-3 px-4 py-2 bg-red-600 rounded hover:bg-red-700">
é‡æ–°åŠ è½½
</button>
<a href="file-check.html" class="mt-3 ml-2 px-4 py-2 bg-blue-600 rounded hover:bg-blue-700 inline-block">
æ–‡ä»¶æ£€æµ‹</a>
`;
}
}

// æ£€æµ‹æœ€ä½³è·¯å¾„
async function detectBestPath() {
updateProgress('æ­£åœ¨æ£€æµ‹æœ€ä½³JSæ–‡ä»¶è·¯å¾„...');
const basePath = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1);
    
const testPaths = [
{ format: (file) => `js/${file}`, label: 'ç›¸å¯¹è·¯å¾„ js/' },
{ format: (file) => `./js/${file}`, label: 'ç›¸å¯¹è·¯å¾„ ./js/' },
{ format: (file) => `/workbench/js/${file}`, label: 'ç»å¯¹è·¯å¾„ /workbench/js/' },
{ format: (file) => `${window.location.origin}${basePath}js/${file}`, label: 'å®Œæ•´URL' }
];

const testFile = 'workbench-config.js';
    
for (const pathConfig of testPaths) {
const testPath = pathConfig.format(testFile);
updateProgress(`æµ‹è¯•è·¯å¾„: ${testPath}`);
        
try {
const response = await fetch(testPath, { method: 'HEAD' });
if (response.ok) {
const contentType = response.headers.get('content-type');
updateProgress(`âœ“ æ‰¾åˆ°å¯ç”¨è·¯å¾„: ${pathConfig.label} (${contentType})`);
return pathConfig.format;
}
} catch (e) {
updateProgress(`âœ— è·¯å¾„å¤±è´¥: ${pathConfig.label} - ${e.message}`, true);
}
}
    
return null;
}

// åŠ¨æ€åŠ è½½è„šæœ¬
function loadScript(src, moduleName) {
return new Promise((resolve, reject) => {
const script = document.createElement('script');
script.src = src;
script.async = false; // ä¿æŒé¡ºåº
        
script.onload = () => {
updateProgress(`âœ“ å·²åŠ è½½: ${moduleName}`);
loadedModules.add(moduleName);
resolve();
};
        
script.onerror = (e) => {
updateProgress(`âœ— åŠ è½½å¤±è´¥: ${moduleName}`, true);
failedModules.add(moduleName);
window.moduleLoadErrors.push({ module: moduleName, src, error: e });
reject(new Error(`Failed to load ${moduleName}`));
};
        
document.head.appendChild(script);
});
}

// ä¸»åŠ è½½æµç¨‹
async function loadModules() {
try {
document.getElementById('loading-progress').textContent = 'æ­£åœ¨æ£€æµ‹æ–‡ä»¶è·¯å¾„...';
        
// æ£€æµ‹æœ€ä½³è·¯å¾„
const pathFormat = await detectBestPath();
        
if (!pathFormat) {
throw new Error('æ— æ³•æ‰¾åˆ°å¯ç”¨çš„JSæ–‡ä»¶è·¯å¾„');
}
        
document.getElementById('loading-progress').textContent = 'æ­£åœ¨åŠ è½½æ ¸å¿ƒæ¨¡å—...';
        
// æ¨¡å—åŠ è½½é¡ºåºï¼ˆä¸¥æ ¼æŒ‰ä¾èµ–å…³ç³»ï¼‰
const modules = [
{ file: 'workbench-config.js', name: 'Config', check: 'WorkbenchConfig' },
{ file: 'workbench-utils.js', name: 'Utils', check: 'WorkbenchUtils' },
{ file: 'workbench-modal.js', name: 'Modal', check: 'WorkbenchModal' },
{ file: 'workbench-state.js', name: 'State', check: 'WorkbenchState' },
{ file: 'workbench-storage.js', name: 'Storage', check: 'WorkbenchStorage' },
{ file: 'workbench-auth.js', name: 'Auth', check: 'WorkbenchAuth' },
{ file: 'workbench-dashboard.js', name: 'Dashboard', check: 'WorkbenchDashboard' },
{ file: 'workbench-orders.js', name: 'Orders', check: 'WorkbenchOrders' },
{ file: 'workbench-suppliers.js', name: 'Suppliers', check: 'WorkbenchSuppliers' },
{ file: 'workbench-finance.js', name: 'Finance', check: 'WorkbenchFinance' },
{ file: 'workbench-expenses.js', name: 'Expenses', check: 'WorkbenchExpenses' },
{ file: 'workbench-crm.js', name: 'CRM', check: 'WorkbenchCRM' },
{ file: 'workbench-app.js', name: 'App', check: 'app' }
];
        
// é¡ºåºåŠ è½½
for (const module of modules) {
const src = pathFormat(module.file);
try {
await loadScript(src, module.name);
                
// éªŒè¯æ¨¡å—æ˜¯å¦æ­£ç¡®æŒ‚è½½
if (typeof window[module.check] === 'undefined') {
throw new Error(`Module ${module.name} loaded but not mounted to window`);
}
} catch (error) {
console.error(`Failed to load ${module.name}:`, error);
// ç»§ç»­åŠ è½½å…¶ä»–æ¨¡å—ï¼Œä¸è¦ä¸­æ–­
}
        }
        
// æ£€æŸ¥å…³é”®æ¨¡å—
const criticalModules = ['WorkbenchConfig', 'WorkbenchUtils', 'WorkbenchStorage'];
const missingCritical = criticalModules.filter(m => typeof window[m] === 'undefined');
        
if (missingCritical.length > 0) {
throw new Error(`å…³é”®æ¨¡å—æœªåŠ è½½: ${missingCritical.join(', ')}`);
}
        
document.getElementById('loading-progress').textContent = '100% å®Œæˆ';
updateProgress(`âœ“ æˆåŠŸåŠ è½½ ${loadedModules.size}/${modules.length} ä¸ªæ¨¡å—`);
        
// å»¶è¿Ÿéšè—åŠ è½½ç•Œé¢
setTimeout(() => {
document.getElementById('system-loading').style.display = 'none';
            
// åˆå§‹åŒ–åº”ç”¨
if (typeof app !== 'undefined' && app.init) {
app.init();
}
}, 500);
        
    } catch (error) {
console.error('[Loader] æ¨¡å—åŠ è½½å¤±è´¥:', error);
document.getElementById('loading-progress').textContent = 'åŠ è½½å¤±è´¥';
        
const suggestions = [
'æ£€æŸ¥ workbench/js/ æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶æ˜¯å¦å®Œæ•´',
'è®¿é—® file-check.html è¿›è¡Œè¯¦ç»†è¯Šæ–­',
'æ£€æŸ¥ Cloudflare Pages çš„æ„å»ºé…ç½®',
'æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯'
];
        
if (failedModules.size > 0) {
suggestions.unshift(`å¤±è´¥çš„æ¨¡å—: ${Array.from(failedModules).join(', ')}`);
}
        
showError('æ¨¡å—åŠ è½½å¤±è´¥', suggestions);
}
}

// é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹åŠ è½½æ¨¡å—
if (document.readyState === 'loading') {
document.addEventListener('DOMContentLoaded', loadModules);
} else {
loadModules();
}

})();
</script>

</body>
</html>
