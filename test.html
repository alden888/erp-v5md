<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åŠŸèƒ½æµ‹è¯• - V14.2 PRO</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-8">
<div class="max-w-4xl mx-auto">
<h1 class="text-3xl font-bold mb-8 text-red-500">ğŸ§ª åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>

<div class="space-y-6">
<!-- 1. LocalStorage æµ‹è¯• -->
<div class="bg-gray-800 p-6 rounded-lg">
<h2 class="text-xl font-bold mb-4">1ï¸âƒ£ LocalStorage æµ‹è¯•</h2>
<button onclick="testLocalStorage()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
è¿è¡Œæµ‹è¯•
</button>
<div id="storage-result" class="mt-4 p-4 bg-gray-900 rounded text-sm"></div>
</div>

<!-- 2. æ¨¡å—åŠ è½½æµ‹è¯• -->
<div class="bg-gray-800 p-6 rounded-lg">
<h2 class="text-xl font-bold mb-4">2ï¸âƒ£ æ¨¡å—åŠ è½½æµ‹è¯•</h2>
<button onclick="testModules()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
æ£€æŸ¥æ¨¡å—
</button>
<div id="modules-result" class="mt-4 p-4 bg-gray-900 rounded text-sm"></div>
</div>

<!-- 3. ç½‘ç»œè¿æ¥æµ‹è¯• -->
<div class="bg-gray-800 p-6 rounded-lg">
<h2 class="text-xl font-bold mb-4">3ï¸âƒ£ ç½‘ç»œè¿æ¥æµ‹è¯•</h2>
<button onclick="testNetwork()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
æµ‹è¯•è¿æ¥
</button>
<div id="network-result" class="mt-4 p-4 bg-gray-900 rounded text-sm"></div>
</div>

<!-- 4. Firebase æµ‹è¯• -->
<div class="bg-gray-800 p-6 rounded-lg">
<h2 class="text-xl font-bold mb-4">4ï¸âƒ£ Firebase è¿æ¥æµ‹è¯•</h2>
<button onclick="testFirebase()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
æµ‹è¯• Firebase
</button>
<div id="firebase-result" class="mt-4 p-4 bg-gray-900 rounded text-sm"></div>
</div>

<!-- 5. å®Œæ•´æµ‹è¯• -->
<div class="bg-gray-800 p-6 rounded-lg">
<h2 class="text-xl font-bold mb-4">5ï¸âƒ£ è¿è¡Œå®Œæ•´æµ‹è¯•</h2>
<button onclick="runAllTests()" class="bg-red-600 hover:bg-red-700 px-6 py-3 rounded font-bold">
ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•
</button>
<div id="all-results" class="mt-4"></div>
</div>
</div>

<div class="mt-8 text-center">
<a href="./index.html" class="inline-block bg-gray-700 hover:bg-gray-600 px-6 py-3 rounded">
è¿”å›ä¸»é¡µé¢
</a>
<a href="./diagnostic.html" class="inline-block bg-gray-700 hover:bg-gray-600 px-6 py-3 rounded ml-4">
ç³»ç»Ÿè¯Šæ–­
</a>
</div>
</div>

<script>
// å·¥å…·å‡½æ•°
function showResult(elementId, status, message) {
const el = document.getElementById(elementId);
const statusClass = status === 'pass' ? 'text-green-500' : status === 'fail' ? 'text-red-500' : 'text-yellow-500';
const icon = status === 'pass' ? 'âœ…' : status === 'fail' ? 'âŒ' : 'âš ï¸';
el.innerHTML = `<span class="${statusClass}">${icon} ${message}</span>`;
}

// 1. LocalStorage æµ‹è¯•
function testLocalStorage() {
try {
const testKey = 'test_' + Date.now();
const testValue = { test: true, timestamp: Date.now() };
localStorage.setItem(testKey, JSON.stringify(testValue));
const retrieved = JSON.parse(localStorage.getItem(testKey));
localStorage.removeItem(testKey);
        
if (retrieved.test === true) {
showResult('storage-result', 'pass', 'LocalStorage è¯»å†™æ­£å¸¸');
} else {
showResult('storage-result', 'fail', 'LocalStorage æ•°æ®ä¸ä¸€è‡´');
}
} catch (e) {
showResult('storage-result', 'fail', `LocalStorage é”™è¯¯: ${e.message}`);
}
}

// 2. æ¨¡å—åŠ è½½æµ‹è¯•
function testModules() {
const modules = [
'WorkbenchConfig',
'WorkbenchUtils',
'WorkbenchModal',
'WorkbenchState',
'WorkbenchStorage'
];

const results = modules.map(mod => {
const exists = typeof window[mod] !== 'undefined';
return `${exists ? 'âœ…' : 'âŒ'} ${mod}`;
});

const allLoaded = modules.every(mod => typeof window[mod] !== 'undefined');
const status = allLoaded ? 'pass' : 'fail';
showResult('modules-result', status, results.join('<br>'));
}

// 3. ç½‘ç»œè¿æ¥æµ‹è¯•
async function testNetwork() {
showResult('network-result', 'warn', 'æ­£åœ¨æµ‹è¯•...');
try {
const response = await fetch('./index.html', { method: 'HEAD' });
if (response.ok) {
showResult('network-result', 'pass', `ç½‘ç»œè¿æ¥æ­£å¸¸ (HTTP ${response.status})`);
} else {
showResult('network-result', 'fail', `HTTP ${response.status} - ${response.statusText}`);
}
} catch (e) {
showResult('network-result', 'fail', `ç½‘ç»œé”™è¯¯: ${e.message}`);
}
}

// 4. Firebase æµ‹è¯•
async function testFirebase() {
showResult('firebase-result', 'warn', 'æ­£åœ¨æµ‹è¯•...');
    
if (typeof firebase === 'undefined') {
showResult('firebase-result', 'fail', 'Firebase SDK æœªåŠ è½½');
return;
}

try {
// æ£€æŸ¥ Firebase é…ç½®
if (window.WorkbenchFirebase && WorkbenchFirebase.DEFAULT_CONFIG) {
const config = WorkbenchFirebase.DEFAULT_CONFIG;
const isDefault = config.projectId === 'v5merp';
            
if (isDefault) {
showResult('firebase-result', 'pass', 
`Firebase SDK å·²åŠ è½½<br>é¡¹ç›®: ${config.projectId}<br>âš ï¸ ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œå»ºè®®æ›´æ–°`);
} else {
showResult('firebase-result', 'pass', 
`Firebase SDK å·²åŠ è½½<br>é¡¹ç›®: ${config.projectId}<br>âœ… å·²è‡ªå®šä¹‰é…ç½®`);
}
} else {
showResult('firebase-result', 'warn', 'Firebase æ¨¡å—æœªå®Œå…¨åŠ è½½');
}
} catch (e) {
showResult('firebase-result', 'fail', `Firebase é”™è¯¯: ${e.message}`);
}
}

// 5. è¿è¡Œæ‰€æœ‰æµ‹è¯•
async function runAllTests() {
const resultsDiv = document.getElementById('all-results');
resultsDiv.innerHTML = '<p class="text-yellow-500">ğŸ”„ æ­£åœ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•...</p>';
    
await new Promise(r => setTimeout(r, 500));
testLocalStorage();
    
await new Promise(r => setTimeout(r, 500));
testModules();
    
await new Promise(r => setTimeout(r, 500));
await testNetwork();
    
await new Promise(r => setTimeout(r, 500));
await testFirebase();
    
resultsDiv.innerHTML = '<p class="text-green-500">âœ… æ‰€æœ‰æµ‹è¯•å·²å®Œæˆï¼è¯·æŸ¥çœ‹ä¸Šæ–¹ç»“æœã€‚</p>';
}
</script>
</body>
</html>
